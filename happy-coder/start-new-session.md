# Start New Session

v1.5.0(2025-09-18)에서 추가. 모바일 기기에서
원격으로 새로운 Claude Code 또는 Codex 세션을
직접 생성하고 시작할 수 있다.

| 항목   | 이전            | 이후                |
| ------ | --------------- | ------------------- |
| 시작   | 데스크톱에서만  | 모바일에서도 가능   |
| 모바일 | 모니터링만      | 생성 + 모니터링     |
| 지원   | Claude Code     | Claude Code + Codex |
| 흐름   | 단방향 핸드오프 | 양방향 전환         |

## 작동 방식

1. 모바일 앱에서 "Start New Session" 버튼을
   탭한다.
2. Claude Code 또는 Codex 중 에이전트를
   선택한다.
3. 작업 디렉토리와 초기 프롬프트를 입력한다.
4. Happy Server가 데스크톱 데몬의 WebSocket
   연결로 `spawn-happy-session` RPC를
   호출한다.
5. 데몬의 `spawnSession()`이 토큰을 환경
   변수로 주입한 뒤 에이전트 프로세스를
   기동한다. Claude의 경우
   `CLAUDE_CODE_OAUTH_TOKEN`, Codex의 경우
   `auth.json`에 토큰을 기록한다.
6. 세션 프로세스가 데몬의
   `/session-started` 웹훅을 호출하여
   등록을 완료한다.
7. 데몬이 Expo 푸시 알림으로 모바일에 세션
   시작을 통지한다.

이때 사용되는 인증 토큰은 RPC 페이로드에
포함된 것으로, 머신의 로컬 계정이 아니라
`happy connect`로 등록한 클라우드 키다.

핵심은 샌드박스나 별도 서비스에 접속하는 것이
아니라, 실제 머신에서 실행되는 실제 Claude Code
세션에 직접 연결된다는 점이다. 세션이 시작되면
양쪽 디바이스에서 동일한 세션에 접근할 수 있으며,
"주(primary)" 디바이스와 "보조(secondary)"
디바이스의 구분이 없다.

## 인사이트

### 감독 패러다임의 변화

이전 모델은 "데스크톱에서 시작 → 모바일로
감독"이었다. 이제는 "어디서든 시작 → 어디서든
감독 → 어디서든 전환"이 된다. 시작 지점에 대한
제약이 사라지면서, 에이전트 감독이 장소에
독립적인 활동이 된다.

### 아이디어와 구현의 간극

아이디어가 떠오르는 순간과 그것을 구현할 수
있는 순간 사이의 간극이 줄어든다. 이 간극은
단순한 불편이 아니라, 아이디어가 사라지거나
동기가 감소하는 실질적 비용이다. 모바일에서
바로 세션을 시작해 에이전트에게 작업을 맡기면,
"나중에 해야지"가 "지금 시작"으로 바뀐다.

### 계정 한계와 우회 아이디어

Start New Session은 `happy connect`로 등록한
클라우드 키를 사용한다. 코드상
`spawn-happy-session` RPC 페이로드의 `token`
필드가 `CLAUDE_CODE_OAUTH_TOKEN` 환경 변수로
주입되며, 3단계 우선순위 시스템에서 인증 토큰은
프로필 환경 변수로 덮어쓸 수 없도록 보호된다.

디바이스마다 서로 다른 Anthropic 계정이
로그인되어 있어도 원격 세션은 항상 클라우드 키
하나로 실행된다. 로컬 계정의 플랜이나 과금
체계를 그대로 쓰고 싶다면 이 구조가 제약이
된다.

우회 아이디어로 "headquarters `happy`" 패턴이
있다. 데스크톱에서 `happy` 세션을 하나 띄워두고,
모바일에서 이 세션에게 "다른 디렉토리에서
`happy` 하나 더 띄워줘"라고 지시하는 것이다.
새 세션은 로컬에서 기동되므로 머신의 로컬
계정을 사용한다. 첫 세션만 데스크톱에서 직접
띄우면(또는 Start New Session으로 띄우면)
이후 확장은 로컬 계정으로 가능하다.

다만 한계도 있다. `happy`는 인터랙티브
CLI이므로 Claude Code의 bash 도구로 완전히
제어하기 어렵고, AI가 AI를 감독하는 구조가
되어 Happy Coder의 설계 의도(사람이 에이전트를
감독)와 어긋날 수 있다.

# Ralph Loop Setup

<https://twitter.com/d4m1n/status/2026032801322356903>

AI 에이전트를 장시간 자율 실행시키는 워크플로우.
4개 프로젝트를 이 방식으로 출시했고,
최장 37시간 연속 실행으로 2,000줄 요구사항에서
250개 작업을 완료했다고 한다.

## 핵심 구조

Docker 샌드박스 안에서 Claude Code(또는 다른
에이전틱 CLI)가 반복 루프를 돈다.

```
.agent/
├── PROMPT.md      # 반복 실행 지침
├── SUMMARY.md     # 프로젝트 요약 (컨텍스트)
├── STEERING.md    # 실행 중 방향 전환용
├── tasks.json     # 작업 목록
├── tasks/         # 개별 작업 스펙
├── prd/           # 제품 요구사항 문서
├── logs/          # 진행 추적
├── history/       # 반복 출력 기록
└── skills/        # 재사용 가능한 에이전트 스킬
```

### 실행 흐름

1. 에이전트가 작업 목록에서 최우선 작업을 선택
2. 구현
3. 테스트 실행으로 검증
4. 커밋
5. 종료 → 다음 반복은 새 컨텍스트로 시작

## 왜 작동하는가

**컨텍스트 윈도우 고갈 회피.**
대부분의 AI 코딩 세션은 컨텍스트가 차면 죽는다.
모델이 이전 지시를 잊고 출력 품질이 떨어진다.

Ralph Loop은 이걸 구조적으로 해결한다.
매 반복마다 새 컨텍스트로 시작하고,
상태는 텍스트 파일과 git 커밋에 저장한다.
컨텍스트 윈도우가 아니라 파일 시스템이 메모리다.

## 잘 되는 것 vs 안 되는 것

| 강점                     | 약점                     |
| ------------------------ | ------------------------ |
| 프로토타이핑, MVP        | 픽셀 퍼펙트 디자인       |
| E2E/단위 테스트 자동화   | 전례 없는 신규 아키텍처  |
| 프레임워크 마이그레이션  | 보안 크리티컬 코드       |
| 반복 작업 (리팩터링 등)  |                          |

## 실전 팁

- **테스트 필수 설치.** Playwright + Vitest.
  테스트 없으면 에이전트가 검증 없이 진행한다.
- **API 키는 미리 준비.** `.env`에 넣어두지 않으면
  통합 검증을 건너뛴다.
- **외부 문서는 마크다운으로 저장 후 참조.**
  에이전트가 추측하지 않게 `@docs/FILE.md`로 지정.
- **STEERING.md로 실행 중 개입.**
  크리티컬 버그 발견 시 여기에 쓰면 다음 반복에서
  우선 처리한다.
- **작게 시작 후 스케일업.** `-n 2` → `-n 10` →
  `-n 30` 순서로 신뢰도를 확인하며 늘린다.
- **리뷰를 건너뛰지 말 것.** 생성된 작업 스펙을
  반드시 검토. 잘못된 스펙 수정이 10개 커밋
  되돌리기보다 싸다.

## 인사이트

### 1. 루프는 바보다. 진짜 일은 메타 작업이다.

> Ralph is just a loop. The real work is in the
> setup around it.

`while true; do task; done` 같은 루프는 누구나
짠다. 그런데 거의 아무도 실제로 돌리지 못했다.
트윗이 직접 말한다: "Everyone saved a bunch of
Ralph Loop articles. Almost nobody actually set
it up."

**아이디어와 작동하는 워크플로우 사이의 간극이
진짜 해자(moat)다.** 프롬프트 구조, 작업 분해,
검증 기준 — 이 메타 작업을 몇 주간 반복해야
비로소 돌아간다. 기술적으로 어려운 게 아니라
운영적으로 어렵다.

### 2. 테스트는 에이전트의 눈이다

테스트 없는 자율 에이전트는 눈 감고 달리는 차다.
틀린 코드를 커밋하고, 그 위에 또 쌓고,
10개 커밋 뒤에야 문제가 드러난다.

TDD의 의미가 완전히 바뀐다.
사람을 위한 품질 보증 → **에이전트의 자기 검증
메커니즘.** 테스트를 안 쓰면 자동화 자체가
불가능해지는 구조. 2026년에 테스트를 안 쓰는 건
에이전트에게 "확인하지 마" 라고 말하는 것이다.

### 3. 컨텍스트 윈도우는 RAM이고, 파일은 디스크다

대부분의 AI 세션이 죽는 이유:
상태를 전부 컨텍스트 윈도우(RAM)에 넣는다.
차면 잊고, 잊으면 틀린다.

Ralph Loop의 핵심 통찰은 컴퓨터 아키텍처에서
이미 풀린 문제를 AI에 적용한 것이다.
**휘발성 메모리(컨텍스트)와 영속 저장소(파일,
git)를 분리하라.** 매 반복마다 컨텍스트를 비우고,
필요한 상태만 파일에서 로드한다.
이건 페이징(paging)이다.

[File-based Planning Workflow](./file-based-planning-workflow.md)와
동일한 원리. Ralph Loop은 여기에 Docker 샌드박스
+ 자동 반복 실행 + PRD 생성까지 패키징한 것.

### 4. STEERING.md는 비동기 관제탑이다

완전 자율은 환상이다. 37시간 돌리더라도
중간에 방향 수정이 필요하다.

STEERING.md의 설계가 영리하다:
에이전트가 매 반복 시작 시 이 파일을 읽는다.
사람은 아무 때나 이 파일을 수정한다.
**파일 시스템이 비동기 커뮤니케이션 채널이 된다.**

이건 "감독된 자율(supervised autonomy)"의
최소 구현이다. 에이전트를 멈추지 않고도
우선순위를 바꿀 수 있다.

### 5. git revert가 에러 핸들링이다

작업 하나 = 커밋 하나.
실패하면 `git revert` → 테스트 실패 →
다음 반복에서 재시도.

이건 단순한 버전 관리가 아니다.
**git을 트랜잭션 시스템으로 쓰는 것이다.**
각 커밋이 원자적 롤백 단위.
실패 복구를 워크플로우에 내장한 설계.

### 6. 역할이 바뀐다

> Your role changes. You stop being the one who
> writes every line and start being the one who
> plans, delegates, and reviews.

코드를 빨리 치는 능력의 가치가 급락한다.
올라가는 건: UI 스펙, 흐름 설계, 제약조건 정의,
통합 요건 기술, 그리고 **통과 기준을 정확히
정의하는 능력.**

"인터뷰해줘"라는 요구사항을 넣으면 에이전트가
알아서 질문한다는 팁이 상징적이다.
사람은 답을 알고, 에이전트는 질문할 줄 안다.
**역할 분담의 최적점이 여기다.**

## 출처

- [Ralph Loop GitHub](https://github.com/anthropics/ralph-loop)
  → 실제 저장소는 `@pageai/ralph-loop`
- [Anthropic 장시간 에이전트 연구](https://www.anthropic.com)
  → 작업 포맷의 연구적 근거

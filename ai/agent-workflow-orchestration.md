# AI Agent Workflow Orchestration Guidelines

[AI Agent Workflow Orchestration Guidelines](
https://gist.github.com/OmerFarukOruc/a02a5883e27b5b52ce740cadae0e4d60
)

AI 코딩 에이전트를 실제 코드베이스에서 올바르게 운영하기 위한
종합 가이드라인이다.

## 핵심 철학

| 원칙                    | 해석                                  |
| ----------------------- | ------------------------------------- |
| Correctness > Cleverness | 영리한 코드보다 읽히는 코드           |
| Smallest blast radius   | 수정 범위를 최소한으로 제한           |
| Leverage existing       | 새 추상화 전에 기존 패턴 우선         |
| Prove it works          | "아마 될 것 같다"는 완료가 아님       |

## 워크플로우 전략

### 1. Plan Mode Default

3단계 이상, 다중 파일 변경, 아키텍처 결정, 프로덕션 영향이 있는
작업은 반드시 계획부터 시작한다.
새 정보가 계획을 무효화하면 즉시 중단하고 계획을 수정한다.

### 2. Subagent Strategy

서브에이전트를 활용해 컨텍스트를 분리하고 병렬 작업을 수행한다.

- 레포 탐색, 패턴 발견, 테스트 실패 분석, 의존성 조사
- 각 서브에이전트에 단일 목표와 구체적 산출물을 부여
- 코딩 시작 전에 결과를 종합

서브에이전트의 핵심 가치는 속도가 아니라 **컨텍스트 오염 방지**다.

### 3. Incremental Delivery

빅뱅 방식 대신 얇은 수직 슬라이스(thin vertical slice)로 전달한다.
각 슬라이스는 DB부터 UI까지 완전히 동작하는 최소 단위여야 한다.
기능 플래그(feature flag)나 안전한 기본값을 적극 활용한다.

### 4. Self-Improvement Loop

```
실수 발생
  → tasks/lessons.md에 기록 (실패 모드, 감지 신호, 예방 규칙)
  → 세션 시작 / 대형 리팩터 전에 재열람
```

세션 간 기억을 파일로 외재화(externalize)하여 같은 실수를 반복하지
않는다. 인간 팀의 포스트모템(postmortem) 문화를 에이전트에 이식한
메커니즘이다.

### 5. Verification Before "Done"

증거(테스트, 빌드, 린트, 로그) 없이는 완료로 표시하지 않는다.
변경 전후 동작을 비교하는 검증 스토리(verification story)가 필요하다.

### 6. Demand Elegance

비자명한 변경에 대해 "부품을 줄일 수 있는가?"를 스스로 묻는다.
단순한 버그 수정에는 과설계(over-engineering)를 피한다.

### 7. Autonomous Bug Fixing

재현 → 원인 격리 → 수정 → 회귀 커버리지 → 검증 순서로 진행한다.
막힌 경우에만 사용자에게 질문하되, 한 번에 하나의 질문과 권장
기본값을 함께 제시한다.

## 태스크 관리 (파일 기반, 감사 가능)

`tasks/todo.md`에 체크리스트를 생성하고 명시적 완료 기준을 정의한다.
한 번에 하나의 항목만 진행 중 상태로 유지한다.
`tasks/lessons.md`에 수정 사항이나 포스트모템 후 교훈을 기록한다.

## 커뮤니케이션 원칙

- **결과 우선**: 파일 경로, 명령어, 에러 메시지 등 구체적 아티팩트를
  제시한다.
- **질문 경제**: 막힌 경우에만, 딱 한 가지 질문을 한다.
- **Busywork 금지**: 모든 단계를 중계하지 않는다. 체크포인트 공유
  조건은 4가지뿐이다: 스코프 변경, 리스크 발견, 검증 실패, 결정 필요.

## 에러 처리 및 복구

### Stop-the-Line Rule

예상치 못한 실패(테스트 실패, 빌드 오류, 동작 회귀)가 발생하면
**기능 개발을 즉시 중단**하고 에러 출력과 재현 단계를 보존한다.
제조업의 안돈 코드(Andon cord) 개념을 에이전트에 적용한 원칙이다.

### Triage 순서

1. 신뢰성 있게 재현
2. 실패 레이어 특정 (UI / API / DB / 네트워크 / 빌드)
3. 최소 실패 케이스로 축소
4. 증상이 아닌 근본 원인 수정
5. 회귀 커버리지 추가
6. 원래 리포트에 대한 End-to-End 검증

### 안전한 폴백

- "안전 기본값 + 경고" 방식을 선호한다.
- 수정 수단으로 광범위한 리팩터를 피한다.
- 프로덕션 영향이 불확실하면 기본값 비활성화 플래그로 배포한다.

## Definition of Done

- 동작이 완료 기준(acceptance criteria)과 일치한다.
- 테스트/린트/타입체크/빌드가 통과했거나 미실행 이유가 문서화됐다.
- 위험한 변경은 롤백 또는 플래그 전략이 있다.
- 코드가 컨벤션을 따르고 읽기 쉽다.
- 검증 스토리가 존재한다: 무엇이 바뀌었고 어떻게 정확성을 확인했는지.

## 인사이트: 이 문서가 의미하는 것

세 가지 패러다임 전환이 담겨 있다.

**① 에이전트를 주니어 개발자로 취급하지 않는다.**
"이렇게 해라"가 아니라 원칙과 판단 기준을 제공해 자율 판단을
유도한다.

**② 파일 시스템이 에이전트의 외재화된 기억이다.**
컨텍스트 윈도우 제한을 극복하면서 감사 가능성(auditability)과
재현 가능성(reproducibility)을 동시에 확보한다.

**③ 롤백 우선 설계(Rollback-first design)가 기본값이다.**
AI 에이전트의 실수 확률을 현실로 인정하고, 모든 변경을 되돌릴 수
있도록 설계하는 것을 원칙으로 삼는다.

> **핵심 요약**: AI 에이전트를 똑똑하게 만드는 것보다, 실수했을 때
> 빠르게 멈추고, 기록하고, 복구하는 시스템이 더 중요하다.

## 관련 문서

- [File-based Planning Workflow](./file-based-planning-workflow.md)
- [Spec-Driven Development](./spec-driven-development.md)

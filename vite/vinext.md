# Vinext

<https://github.com/cloudflare/vinext>

<https://blog.cloudflare.com/vinext/>

## 요약

Vinext는 Next.js API 표면을 Vite 위에서 재구현한
Vite 플러그인이다.

Next.js를 fork하거나 `next build` 출력을 감싸는 방식이 아니라,
Next.js의 라우팅·SSR·`next/*` 모듈 임포트·CLI를
처음부터 독립적으로 다시 구현했다.

핵심 수치:

- **4x** 빠른 빌드 속도
- **57%** 더 작은 번들 크기
- **94%** Next.js API 표면 커버리지
- **$1,100** 상당의 AI 토큰 소비
- **1주일** 개발 기간

## 배경: 왜 만들었나

Cloudflare가 느낀 문제는 두 가지였다.

1. Next.js 빌드 도구체인에 종속되면
   배포 대상과 성능 최적화 여지가 좁아진다.
2. OpenNext처럼 `next build` 결과를 어댑팅하는 방식은
   Next.js 내부 변경마다 깨질 위험이 있다.

해법으로 택한 것은 "API 계약만 존중하고
빌드 전체를 갈아치우는" 접근이다.

## OpenNext와의 차이

| 항목          | OpenNext                          | Vinext                       |
|---------------|-----------------------------------|------------------------------|
| 방식          | next build 결과를 플랫폼에 맞게 변환 | 빌드 자체를 Vite로 대체       |
| Next.js 의존  | 있음                              | 없음                          |
| API 재구현    | 부분적                            | 전체                          |
| 깨짐 위험     | Next.js 내부 변경 시 높음         | API 표면 변경 시에만           |

## 핵심 기능

### 라우팅

Pages Router와 App Router 모두 지원한다.

- 동적 라우트, catch-all 세그먼트
- 병렬 라우트, 인터셉팅 라우트
- 미들웨어
- 파일 기반 메타데이터 라우트
  (sitemap, robots.txt, OG 이미지)

### 서버 사이드 렌더링

- 두 라우터 모두 스트리밍 SSR 지원
- Vite RSC 플러그인을 통한 React Server Components
- ISR(증분 정적 재생성) 포함 정적 생성
- Server Actions

### 개발 경험

- 설정 없이 앱 구조 자동 감지
- HMR 지원
- `.env` 파일 자동 로드

### 배포

- Cloudflare Workers 기본 타깃
  (콜드 스타트 없음, 글로벌 분산)
- 라우팅·모듈 심·SSR 파이프라인은
  Cloudflare 비특화 구조이므로
  다른 플랫폼 이식도 가능
- Vercel 프루프오브컨셉을 30분 만에 완성했다고 밝힘

## Traffic-aware Pre-Rendering (TPR)

가장 주목할 만한 신기능이다.

기존 정적 생성은 "모두 사전 렌더"이거나
"아무것도 사전 렌더하지 않음" 중 하나였다.

TPR는 배포 시점에 Cloudflare 존(zone) 분석을 쿼리해
**실제 트래픽이 높은 페이지만 골라 사전 렌더**한다.

- 나머지는 온디맨드 SSR + ISR 캐시 활용
- 새 배포마다 최신 트래픽 패턴 기반으로 갱신

트래픽 데이터로 사전 렌더 범위를 동적으로 결정하는
아이디어는 인프라와 렌더링 전략을 연결하는 흥미로운 접근이다.

## 마이그레이션 방법

Vinext에는 AI 에이전트용 스킬이 내장되어 있다.
Claude Code, OpenCode, Cursor, Codex 등
주요 AI 코딩 도구와 연동된다.

마이그레이션은 비파괴적이다.

- `next.config`, `tsconfig.json`, 소스 파일 수정 없음
- Next.js 의존성 제거 없음
- 기존 Next.js 설정이 그대로 공존

## AI가 코드를 만든다는 것

Vinext의 코드 대부분은 Claude Code가 작성했다.
인간 엔지니어 1명이 아키텍처 방향을 결정하고,
AI가 구현과 테스트를 담당하는 방식이었다.

결과물:

- Vitest 테스트 1,700개 이상
- Playwright E2E 테스트 380개
- tsgo 기반 전체 TypeScript 타입 검사
- oxlint 기반 린팅
- CI에서 PR마다 전체 실행

Cloudflare는 이 경험을 일반화해서
"API 계약 + 빌드 도구 + AI 모델"이 있으면
그 사이를 AI가 채울 수 있다는 패턴이
다양한 소프트웨어 영역에서 반복될 것이라 전망했다.

## 인사이트

### 1. API 표면이 진짜 계약이다

Next.js를 쓰는 앱 코드는 `next/*` import,
파일 기반 라우팅 규칙,
Server Action 시그니처에만 의존한다.

내부 컴파일러가 무엇인지는 관심 밖이다.
이 사실이 vinext의 가능성을 열었다.

"구현을 교체해도 사용자 코드는 그대로"라는 전략은
플러그인 아키텍처, 인터페이스 우선 설계의
전형적인 활용 사례다.

### 2. 빌드 도구 교체가 성능 레버가 된다

Next.js 컴파일러를 Vite로 바꾼 것만으로
빌드 4x 향상, 번들 57% 감소가 나왔다.

프레임워크 기능 설계와
빌드 도구 효율이 분리 가능한 문제임을
실증했다.

### 3. 플랫폼 데이터가 렌더링 전략을 바꾼다

TPR는 단순한 최적화가 아니라
"인프라가 어플리케이션 레이어 결정에
직접 개입"하는 새로운 패턴이다.

Cloudflare가 트래픽 데이터를 갖고 있기 때문에
할 수 있는 접근이다.
플랫폼 수직 통합의 이점이 렌더링 전략으로
연결된 사례로 볼 수 있다.

### 4. AI 코드 생성의 신뢰 조건

AI가 쓴 코드 1,700개 테스트와
380개 E2E 테스트는 단순한 품질 보증이 아니다.

"AI가 작성했다"는 사실을 신뢰할 수 있으려면
테스트 커버리지와 CI 파이프라인이
그 신뢰의 실질적 근거가 된다.

사람이 리뷰하는 범위가 줄어들수록
검증 자동화의 범위와 엄밀성이
더 중요해진다.

### 5. 실험적이다 = 진지하게 살펴볼 때다

"실험적(experimental)"이라는 레이블은
사용을 미루라는 신호가 아니라,
설계 아이디어를 살펴볼 최적의 시점이라는 신호다.

코드베이스가 작고, 의존이 단순하고,
아키텍처 의도가 명확할 때
구조를 읽기 가장 쉽다.

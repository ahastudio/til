# Claude Code를 활용한 코드 리뷰 자동화

## Code Review Expert

- 트윗: <https://twitter.com/sanyuan0704/status/2018940363277586677>
- GitHub: <https://github.com/sanyuan0704/code-review-expert>

Shawn Yang이 만든 Claude Code 스킬로, 시니어 엔지니어 수준의 코드 리뷰를
자동화한다.

이 스킬을 분석하여 Claude Code 활용법과 인사이트를 정리한다.

## 스킬 구조

```text
code-review-expert/
├── SKILL.md                 # 스킬 정의 (핵심)
├── agents/agent.yaml        # 에이전트 인터페이스
└── references/              # 참조 체크리스트
    ├── solid-checklist.md
    ├── security-checklist.md
    ├── code-quality-checklist.md
    └── removal-plan.md
```

### SKILL.md의 역할

스킬의 핵심 동작을 정의한다:

- 리뷰 워크플로우 (7단계)
- 심각도 분류 기준
- 출력 형식

### references/의 역할

상세한 체크리스트를 분리하여 관리한다.
SKILL.md가 비대해지는 것을 방지하고, 필요 시 참조하도록 한다.

## 5가지 검토 영역

| 영역          | 검토 내용                                       |
|---------------|------------------------------------------------|
| SOLID 원칙    | SRP, OCP, LSP, ISP, DIP 위반 탐지              |
| 보안 스캔     | XSS, 인젝션, SSRF, 레이스 컨디션, 시크릿 누수   |
| 성능 최적화   | N+1 쿼리, CPU 핫스팟, 캐싱 누락, 메모리 문제    |
| 에러 처리     | 무시된 예외, 비동기 에러, 경계 조건 누락        |
| 제거 후보     | 미사용 코드 식별, 안전한 삭제 계획 수립         |

## 심각도 분류 체계

```text
P0 (Critical) → 병합 차단. 보안/데이터 손실 위험
P1 (High)     → 병합 전 수정 필수. 로직 오류, 심각한 위반
P2 (Medium)   → 후속 작업. 코드 스멜, 개선 필요
P3 (Low)      → 선택적. 스타일 개선
```

심각도 분류는 리뷰어와 개발자 모두에게 명확한 우선순위를 제공한다.

## 7단계 리뷰 워크플로우

### 1. 사전 컨텍스트 수집 (Preflight)

```bash
git diff --cached --name-only  # 변경된 파일 목록
git diff --cached              # 실제 변경 내용
```

500줄 이상의 대규모 변경은 배치로 나눠 리뷰한다.

### 2. SOLID & 아키텍처 분석

각 원칙별 진단 질문:

- **SRP**: "이 모듈이 변경되어야 하는 단일 이유는?"
- **OCP**: "기존 코드 수정 없이 새 기능을 추가할 수 있는가?"
- **LSP**: "하위 클래스가 상위 클래스를 대체할 수 있는가?"
- **ISP**: "모든 구현체가 인터페이스의 모든 메서드를 사용하는가?"
- **DIP**: "비즈니스 로직이 구체적 구현에 의존하는가?"

### 3. 제거 후보 식별

미사용 코드를 구분한다:

- **즉시 삭제 가능**: 참조가 없는 코드
- **단계적 제거 필요**: 외부 의존성이 있는 코드

### 4. 보안 & 신뢰성 검사

주요 체크 항목:

- 인젝션 공격 (XSS, SQL, Command)
- 인증/인가 누락
- JWT 토큰 취약점
- 시크릿 노출
- 레이스 컨디션

### 5. 코드 품질 검토

- 빈 catch 블록 (silent failure)
- N+1 쿼리 패턴
- 경계 조건 미처리 (0, null, empty)
- truthy 체크로 인한 유효값 제외

### 6. 구조화된 출력

심각도별로 그룹화하여 제시:

```markdown
## P0 - Critical

### [파일명:라인] 이슈 제목
- **문제**: 설명
- **해결**: 권장 수정 방안

## P1 - High
...
```

### 7. 사용자 확인

자동 수정 전 명시적 승인을 요청한다.
리뷰 우선 원칙을 유지한다.

## 인사이트

### 1. 체크리스트 분리의 가치

SKILL.md에 모든 것을 담지 않는다.
references/ 디렉터리로 상세 내용을 분리하면:

- 스킬 정의가 간결해진다
- 체크리스트를 독립적으로 업데이트할 수 있다
- 필요한 부분만 참조하여 컨텍스트를 절약한다

### 2. 진단 질문의 효과

"이 코드는 SOLID를 위반한다"보다
"이 모듈이 변경되어야 하는 단일 이유는 무엇인가?"가 효과적이다.

질문 형태는 AI가 맥락을 파악하고 구체적으로 분석하도록 유도한다.

### 3. 심각도 체계의 중요성

P0~P3 분류는 단순한 레이블이 아니다:

- 개발자가 어디에 집중해야 하는지 명확히 한다
- 리뷰 피로도를 줄인다
- 병합 결정을 객관화한다

### 4. 자동 수정 전 확인 원칙

스킬이 직접 수정하지 않고 확인을 요청하는 이유:

- 컨텍스트를 AI가 완전히 이해하지 못할 수 있다
- 의도적인 설계 결정일 수 있다
- 개발자의 학습 기회를 보존한다

## 활용 방법

### 플러그인 설치

```bash
claude plugins add https://github.com/sanyuan0704/code-review-expert
```

### 직접 참조

프로젝트의 CLAUDE.md에 체크리스트를 통합하거나,
필요한 부분만 발췌하여 커스터마이징할 수 있다.

### 커스텀 스킬 제작 시 참고 사항

1. 핵심 로직과 상세 참조를 분리한다
2. 진단 질문 형태로 체크리스트를 작성한다
3. 명확한 심각도/우선순위 체계를 정의한다
4. 자동 실행보다 검토 후 실행을 기본으로 한다

## 관련 문서

- [Claude Code](./claude-code.md)
- [Karpathy-Inspired Claude Guidelines](../ai/karpathy-inspired-claude-guidelines.md)

# Prism으로 빠르게 Mock API 서버 띄우기

프론트엔드와 백엔드 개발을 병렬로 진행하려면, 백엔드 구현이 완료되기 전에 API
스펙에 맞는 Mock API 서버가 필요합니다.

Prism은 OpenAPI 스펙 문서만 있으면 Mock API 서버와 검증 프록시를 바로 띄울 수
있는 오픈소스 도구입니다.

여기서는 Prism의 검증 기능은 제외하고 Mock API 서버를 띄우는 방법만 간단히
알아보겠습니다.

## Prism 설치

Prism은 Node.js 기반 CLI 도구입니다.

다음과 같이 npm으로 설치해서 사용할 수 있습니다.

```bash
npm i -g @stoplight/prism-cli
```

잘 설치됐는지 확인하기 위해 Prism 버전을 출력해 보겠습니다.

```bash
prism --version
```

## Mock 서버 띄우기

이제 OpenAPI 스펙 문서 파일(`openapi.yaml`)을 이용해 Mock API 서버를 바로 실행할
수 있습니다.

```bash
prism mock openapi.yaml
```

웹에 있는 OpenAPI 스펙 문서를 바로 사용할 수도 있습니다.

```bash
prism mock https://petstore3.swagger.io/api/v3/openapi.json
```

기본적으로 `4010` 포트에서 Mock API 서버가 실행됩니다.

포트를 변경하고 싶다면 `--port` 옵션을 사용하면 됩니다.

```bash
prism mock openapi.yaml --port 8080
```

## 간단한 API 호출 테스트

여기서는 와일드 프론트엔드 강의에서 사용한
[Tickets API 스펙 문서](https://github.com/dal-lab/openapi-sample/tree/main/tickets)를
사용해서 API 서버를 띄워보겠습니다.

```bash
prism mock https://raw.githubusercontent.com/dal-lab/openapi-sample/refs/heads/main/tickets/openapi.yaml
```

티켓 목록을 확인해 보겠습니다.

```bash
curl -i http://localhost:4010/tickets
```

응답 결과는 OpenAPI 스펙에 정의된 example 데이터를 활용합니다.

티켓을 만드는 API도 호출해 보겠습니다.

```bash
curl -i -X POST http://localhost:4010/tickets \
  -H "Content-Type: application/json" \
  -d '{}'
```

요청 데이터가 올바르지 않기 때문에 `422 Unprocessable Entity`로 응답하는 걸 볼
수 있습니다.

다음과 같이 올바르게 입력하면 `201 Created`로 성공 응답을 얻을 수 있습니다.

```bash
curl -i -X POST http://localhost:4010/tickets \
  -H "Content-Type: application/json" \
  -d '{"title": "New Ticket", "description": "Details about the ticket"}'
```

## 동적 응답 생성

항상 같은 응답만 얻으면 다양한 상황을 테스트하기 어렵습니다. 이럴 때는
`--dynamic` 또는 `-d` 옵션을 사용해서 Faker 기반의 더미 데이터를 생성할 수
있습니다. (내부적으로 Lorem ipsum을 활용합니다.)

```bash
prism mock -d openapi.yaml
```

## 결론

OpenAPI 스펙은 다양하게 활용할 수 있고, Prism은 그중 하나일 뿐입니다. API 문서를
생성하는 [Redoc](https://redoc.ly/), 스펙을 검증하는
[Spectral](https://stoplight.io/spectral), API를 테스트하는
[Dredd](https://dredd.org/), TypeScript 타입을 생성하는
[OpenAPI TypeScript](https://openapi-ts.dev/), TypeScript 클라이언트 코드를
생성하는 [Orval](https://orval.dev/), 다양한 언어로 서버 코드를 생성하는
[OpenAPI Generator](https://openapi-generator.tech/) 등 OpenAPI 기반의 강력한
도구들이 많습니다.

API 스펙을 먼저 정의하고 개발을 진행하는 API Specification-Driven Development를
통해 다양한 이점을 누려 보세요.

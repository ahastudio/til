# Spring REST Docs ê°„ë‹¨íˆ ì¨ë³´ê¸°

- [ì•„ë“€ 2020!](https://adieu2020.ahastudio.com/)
- ì´ì „ ê¸€: [Spring Web MVC í”„ë¡œì íŠ¸ì—ì„œ Interceptor ê°„ë‹¨íˆ ì¨ë³´ê¸°](https://j.mp/2WPC6LE)
- ë‹¤ìŒ ê¸€: [ì• ìì¼ í”„ë™í‹°ìŠ¤]

---

í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ì‚´ì•„ìˆëŠ” ë¬¸ì„œë¼ê³  ë§í•˜ê³¤ í•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ REST APIë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´
í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì½ìœ¼ë¼ê³  ìš”ì²­í•˜ë©´ ê³¤ë€í•˜ê² ì£ ?
ë‹¤ë¥¸ ì‚¬ëŒë“¤ì—ê² ì ì ˆí•œ ë¬¸ì„œë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.

ì´ë²ˆ ê¸€ì—ì„œëŠ” [Spring REST Docs](https://j.mp/3hkZYjr)ë¥¼ ì¨ì„œ
í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì´ìš©í•´ API ë¬¸ì„œë¥¼ ë§Œë“¤ì–´ ë³´ê² ìŠµë‹ˆë‹¤.

## Gradle ì„¤ì •

MockMvcë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ìˆëŠ” í”„ë¡œì íŠ¸ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.

ì˜ì¡´ì„±ì„ ì¶”ê°€í•™ê¸° ìœ„í•´ `build.gradle` íŒŒì¼ì— ë‹¤ìŒì˜ ë‚´ìš©ì„ ë„£ì–´ì¤ì‹œë‹¤.

```groovy
plugins {
    // ...(ì „ëµ)...

    // Asciidoctor
    id 'org.asciidoctor.convert' version '2.4.0'
}

// ...(ì¤‘ëµ)...

dependencies {
    // ...(ì „ëµ)...

    // Spring REST Docs
    asciidoctor 'org.springframework.restdocs:spring-restdocs-asciidoctor'
    testImplementation 'org.springframework.restdocs:spring-restdocs-mockmvc'
}

// ...(ì¤‘ëµ)...

// ğŸ‘‡ ì´ ì„¤ì •ì„ ì œì™¸í•˜ë©´ asciidocë³´ë‹¤ ë¨¼ì € testë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.
asciidoctor {
    dependsOn test
}
```

## Asciidoc ë¬¸ì„œ ìƒì„±

í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¡°ê¸ˆë§Œ ê³ ì³ì£¼ë©´ Asciidoc ë¬¸ì„œ ì¡°ê°(snippets)ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì¼ë‹¨ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì— `@AutoConfigureRestDocs` ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì¤ë‹ˆë‹¤.

```java
@WebMvcTest(ProductController.class)
@AutoConfigureRestDocs
class ProductControllerTest {
```

ì—¬ê¸°ê¹Œì§€ëŠ” ì•„ì£¼ ì‰½ì£ ?

ì´ì œ MockMvc ì²´ì¸ ëì— `andDo`ë¡œ `document`ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
ì—¬ê¸°ì— Asciidoc ë¬¸ì„œ ì¡°ê°(snippet) ì´ë¦„ì„ ì…ë ¥í•©ë‹ˆë‹¤.

```java
    @Test
    void list() throws Exception {
        mockMvc.perform(get("/products"))
                .andExpect(status().isOk())
                .andDo(document("get-products"));
    }
```

ì´ê²ƒë„ ì‰½ìŠµë‹ˆë‹¤.
ì¡°ê° ì´ë¦„ì´ ì¤‘ë³µë˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•˜ëŠ” ê²Œ ì „ë¶€ì…ë‹ˆë‹¤.

í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ë¬¸ì„œ ì¡°ê°ì´ ë§Œë“¤ì–´ ì§‘ë‹ˆë‹¤.

```bash
./gradlew test
```

`build/generated-snippets/get-products` í´ë”ì—
ì—¬ëŸ¬ Asciidoc íŒŒì¼(`.adoc`)ì´ ìƒê¸´ ê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## í•˜ë‚˜ì˜ HTML íŒŒì¼ ë§Œë“¤ê¸°

Asciidoc íŒŒì¼ì„ ëª¨ì•„ì„œ í•˜ë‚˜ì˜ ë¬¸ì„œ íŒŒì¼ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸€ì„ ì“°ëŠ” ê±´ ì§ì ‘ í•´ì•¼ í•˜ë‹ˆ íŒŒì¼ì„ í•˜ë‚˜ ì¶”ê°€í•©ë‹ˆë‹¤:
`src/docs/asciidoc/index.adoc`

```asciidoc
= API ë¬¸ì„œ

== `GET /products` - ì œí’ˆ ëª©ë¡ ì–»ê¸°

HTTP request:

include::{snippets}/get-products/http-request.adoc[]

HTTP response:

include::{snippets}/get-products/http-response.adoc[]
```

Gradleë¡œ `asciidoc` ì‘ì—…ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.

```bash
./gradlew asciidoc
```

ì´ì œ `build/asciidoc/html5` í´ë”ì— HTML íŒŒì¼ì´ ìƒê²¼ìŠµë‹ˆë‹¤.

```bash
open build/asciidoc/html5/index.html
```

## ë” ì•Œì•„ë³¼ ê²ƒ

ì§€ê¸ˆê¹Œì§€ëŠ” ê¸°ë³¸ì ì¸ ë¬¸ì„œ ì¡°ê°ë§Œ ë§Œë“¤ì–´ì„œ ì¨ë´¤ìŠµë‹ˆë‹¤.
í•˜ì§€ë§Œ ë¬¸ì„œë¥¼ ë” í’ì„±í•˜ê²Œ ë§Œë“¤ë ¤ë©´
`document` ë©”ì„œë“œì— ë‹¤ë¥¸ snippetë„ ì¶”ê°€í•  ìˆ˜ ìˆê³ ,
`requestFields` ê°™ì€ ê±´ êµ‰ì¥íˆ ìì£¼ ì“°ì´ê³  ìœ ìš©í•©ë‹ˆë‹¤.

```java
    @Test
    void create() throws Exception {
        mockMvc.perform(
                post("/products")
                        .contentType(MediaType.APPLICATION_JSON)
                        .content("{" +
                                "\"name\":\"NAME\"," +
                                "\"maker\":\"MAKER\"," +
                                "\"price\":1000" +
                                "}")
        )
                .andExpect(status().isCreated())
                .andDo(document(
                        "post-products",
                        requestFields(
                                fieldWithPath("name")
                                        .type(JsonFieldType.STRING)
                                        .description("ì´ë¦„"),
                                fieldWithPath("maker")
                                        .type(JsonFieldType.STRING)
                                        .description("ì œì¡°ì‚¬"),
                                fieldWithPath("price")
                                        .type(JsonFieldType.NUMBER)
                                        .description("ê°€ê²©")
                        )
                ));
    }
```

ë¬¸ì„œì—ë„ ë‹¤ìŒ ë‚´ìš©ì„ ë”í•´ì¤ë‹ˆë‹¤.

`src/docs/asciidoc/index.adoc`

```asciidoc
// ...(ì „ëµ)...

== `POST /products` - ì œí’ˆ ì¶”ê°€í•˜ê¸°

Request fields:

include::{snippets}/post-products/request-fields.adoc[]

HTTP request:

include::{snippets}/post-products/http-request.adoc[]

HTTP response:

include::{snippets}/post-products/http-response.adoc[]
```

ì´ì œ HTML ë¬¸ì„œë¥¼ ë§Œë“¤ì–´ í™•ì¸í•´ ë´…ì‹œë‹¤.

```bash
./gradlew asciidoc
```

---

- [ì•„ë“€ 2020!](https://adieu2020.ahastudio.com/)
- ì´ì „ ê¸€: [Spring Web MVC í”„ë¡œì íŠ¸ì—ì„œ Interceptor ê°„ë‹¨íˆ ì¨ë³´ê¸°](https://j.mp/2WPC6LE)
- ë‹¤ìŒ ê¸€: [ì• ìì¼ í”„ë™í‹°ìŠ¤]

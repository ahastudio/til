# Cosmologically Unique ID

<https://jasonfantl.com/posts/Universal-Unique-IDs/>

<https://news.hada.io/topic?id=26821>

UUID는 지구에서 쓰기엔 충분하다.
그런데 인류가 은하 너머로 퍼져나간다면?
중앙 권한 없이, 우주 어디서든 충돌 없는 ID를
만들려면 몇 비트가 필요할까?

## 랜덤 ID

가장 단순한 방법은 매번 랜덤 숫자를 뽑는 것이다.
중앙 서버도, 조율도 필요 없다.
문제는 두 기기가 같은 숫자를 뽑을 수 있다는 점인데,
숫자 범위를 충분히 크게 잡으면
충돌 확률을 "사실상 0"으로 만들 수 있다.

운석에 맞을 확률은 0이 아니다.
하지만 지구상 모든 사람이 지금 이 순간
동시에 운석에 맞을 확률은?
0은 아니지만 사실상 불가능하다.
ID 충돌 확률을 바로 그 수준으로 낮출 수 있다.

## 얼마나 커야 하는가

"Universal Limits on Computation" 논문에 따르면,
우주 전체를 최대 효율 컴퓨터(Computronium)로
바꿔도 열 죽음(Heat Death)까지
약 10^120번의 연산만 가능하다.

생일 역설(Birthday Paradox)로 계산하면,
n개의 ID를 랜덤 생성할 때 충돌이 기대되는
ID 공간 크기는 n^2이다.

모든 연산이 새 ID를 생성한다고 가정하면:

| 시나리오                                | 필요 비트 |
|-----------------------------------------|-----------|
| Computronium 전체 연산 (10^120)         | ~798      |
| 관측 가능한 우주의 모든 원자 (10^80)    | ~532      |
| 우주 전체 질량을 1g 나노봇으로 (10^57)  | ~372      |
| 현행 UUID v4                            | 122       |

798비트면 모든 장치, 모든 마이크로칩,
모든 키 입력, 모든 시계의 모든 틱,
모든 별과 모든 원자에 ID를 부여해도
충돌이 기대되지 않는다.

## 결정론적 방식의 탐구

"사실상 0"이 아니라 "진짜 0"을 원한다면?
확률적 접근을 거부하고 이론적으로 충돌이
불가능한 결정론적(Deterministic) 방식을 탐구한다.

### Dewey 방식

중앙 컴퓨터가 카운터로 ID를 순차 할당하면
고유성은 보장된다. 하지만 먼 행성에서
중앙 서버에 접근할 수 없다면?

ID를 가진 모든 기기가 하위 ID를 할당할 수 있게
하면 된다. 위성 13이 할당한 6번째 ID는 `13.5`,
그 식민선이 만든 로봇은 `13.5.3`이 된다.
듀이 십진분류법과 유사한 계층 구조다.

확장 트리(넓게 퍼지는 경우)에서는
로그 성장하지만, 체인(한 줄로 이어지는 경우)
에서는 선형으로 커진다.

### Binary, 2-Adic Valuation, Token 방식

Binary 방식은 ID 공간을 이진 트리로 나누어
각 기기에 무한한 하위 ID 풀을 부여한다.
2-Adic Valuation은 산술적 변환으로
Binary와 동일한 성장 특성을 가진다.
Token 방식은 토큰 전달과 홉 카운트를 사용하여
체인에서 로그 성장을 달성하지만,
폭과 깊이가 함께 자라면 다시 선형이 된다.

### 결정론적 방식의 한계 증명

**어떤 결정론적 방식이든
최악의 경우 ID 길이는 선형으로 증가한다.**

n개 노드를 추가할 때 가능한 모든 할당 이력을
고려하면, 고유해야 하는 ID 수가 2^n으로 증가한다.
이를 카운터로 인코딩해도 최소 n비트가 필요하므로,
어떤 방식을 쓰든 최악의 경우 선형 성장을 피할 수
없다.

## 우주 규모 시뮬레이션

실제 인류 확장 모델을 시뮬레이션해 보면
결정론적 방식의 문제가 극명해진다.

행성 하나에서 Fitness 모델(기기별 인기도에 따른
ID 요청 분포)로 시뮬레이션하면,
Dewey 방식이 가장 좋은 성능을 보이며
평균적으로 로그 성장한다.

하지만 행성 간, 은하 간으로 확장하면:

| 규모         | Dewey 방식 ID 길이 |
|--------------|---------------------|
| 행성 하나    | ~900비트            |
| 은하 끝까지  | ~2,700,000비트      |

은하 끝까지 도달하면 약 270만 비트,
**ID 하나에 338KB**가 필요하다.
랜덤 방식의 최대 798비트(100바이트)와 비교하면
압도적으로 비효율적이다.

## HN 반론: 인과적 접촉

원문은 우주 전체의 모든 ID가 서로 충돌할 수 있다고
가정하지만, 실제로 충돌이 "의미 있으려면" 두 ID가
인과적 접촉(Causal Contact)을 해야 한다.
빛의 원뿔(Light Cone)로 제한되는 통신 범위를
고려하면, 생일 역설을 우주 전체에 적용하는 것은
문제를 과대평가하는 것이다.

이 관점에서 보면 128비트는 인류가 천 년간
만들 시스템에도 충분하고,
256비트면 우주 전체에도 과하다.

또 다른 관점: 전 인류의 데이터 총량은 아직
1요타바이트(Yottabyte)도 안 된다.
256비트 ID로 50% 충돌 확률에 도달하려면
약 10^16 요타바이트의 ID가 필요하다.
데이터센터가 수백만 번 폭발할 확률이
충돌 확률보다 높다.

## HN 반론: 신뢰할 수 없는 주체

단일 시스템이라면 단순 카운터로 충분하고,
여러 서버라면 샤딩된 카운터로 구간을 나누면 된다.
하지만 분산 환경에서 신뢰할 수 없는 주체가
ID를 생성한다면 랜덤 충돌이 아니라
악의적 충돌(Intentional Collision)이 문제이므로,
비트 수와 무관하게 검증이 필요하다.

## 인사이트

- **"확률적으로 0"은 "사실상 0"이다.**
  결정론적 보장을 추구한 결과 338KB짜리 ID가
  나왔다. 랜덤 100바이트가 압도적으로 이긴다.
  완벽주의를 버리는 것이 올바른 엔지니어링이다.
- **인과성이 문제를 축소한다.**
  충돌은 두 ID가 만나야만 의미가 있다.
  빛의 원뿔로 제한되는 실제 통신 범위를
  고려하면 필요한 비트 수는 훨씬 줄어든다.
  원문의 798비트는 최악 중의 최악이다.
- **물리학이 상한선을 정해준다.**
  Computronium 모델은 "이보다 더 많은 ID는
  물리적으로 생성 불가능"이라는 절대 한계를
  제공한다. 엔지니어링의 "충분히 큰 숫자"를
  물리학이 증명해 주는 셈이다.
- **분산 시스템의 본질: 조율 없는 고유성.**
  UUID가 답이 된 이유는 "충분히 큰 랜덤"이
  합의(Consensus) 프로토콜 없이도
  고유성을 달성하기 때문이다.
  빛의 속도 제약이 있는 우주 규모에서
  중앙 조율은 원천적으로 불가능하다.
- **최악의 경우를 증명할 수 있다.**
  결정론적 ID 할당의 최악 선형 성장은
  정보 이론적으로 증명된 하한이다.
  "더 똑똑한 알고리즘"으로 해결할 수 없는
  근본적 한계가 존재한다.
- **충돌보다 악의가 더 현실적 위협이다.**
  랜덤 충돌 확률은 천문학적으로 낮지만,
  신뢰할 수 없는 주체의 의도적 충돌은
  비트 수로 막을 수 없다.
  공개키를 ID로 쓰거나 서명 체인을 붙이는 등
  별도의 검증 메커니즘이 필요하다.

## 참고

- [UUID](./uuid.md)
- [ULID](./ulid.md)
- [TSID](./tsid.md)

# 2022-11-29

## <https://innu3368.tistory.com/196>

“같은 리소스여도 다른 의미의 이름으로 구분되어야 한다면 Controller를 나눈다”가
아니라 다른 리소스라서 나뉘는 겁니다. `/music/a.mp3`는 music이 아니라 mp3입니다.
`/games/3/members`는 game이 아니라 member죠. 만약 여기서 game이 나온다면
`members`란 표현은 아예 없어져도 됩니다. 그런데 아니잖아요. 우리가
`/games/3/members`라고 쓰는 건 그냥 `/memebrs?gameId=3`과 동일합니다. nested
URL로 URL을 더 깔끔하게 만드는 것뿐이죠. 리소스가 같아도 분리하는 게 아니라,
리소스가 다르기 때문에 분리하는 겁니다. 리소스가 뭔지 헷갈리면 안 돼요.

그리고 members는 games의 하위 리소스가 아닙니다. 그냥 리소스죠. 위에 쓴 것처럼
`/어쩌고/저쩌고/items`는 그냥 `/items?어쩌고저쩌고`를 예쁘게 잡아주는 겁니다.
경로는 어떤 의미를 부여하는 역할을 할 수 있지만, 이게 본질이 되진 않아요. 제가
바탕화면에 “오늘 할 일.txt”를 만들었을 때, 이게 바탕화면인 건 아닙니다.
바탕화면과는 사실 큰 상관이 없죠. `/Users/user/Desktop/오늘 할 일.txt`에서 앞의
경로는 어떤 의미를 갖긴 해도 사실은 큰 의미가 없어요. 이게 어떤 의미를 갖는
상황은 이것과 비교할 때 밖에 없죠: `/Users/user/Documents/오늘 할 일.txt`. 둘 다
파일명이 같지만 실제론 다르다는 걸 경로를 통해서 드러내고 있죠? (약간 이상한
비유를 들자면, 클래스는 같지만 인스턴스가 다른 느낌으로.) `/games/1/members`와
`/games/2/members`는 둘 다 members입니다. 그런데 열어보면 다르겠죠. 마치
바탕화면에 있는 할 일 목록 파일과 내 문서에 있는 할 일 목록 파일의 내용이 다른
것처럼요. 하지만 이게 의미하는 건 할 일 목록과 마찬가지로 그냥 members입니다.
이건 하위 리소스가 아니라 그냥 리소스고, 경로(path)가 있는 것뿐입니다. 안
헷갈리게 관리할 자신이 있다면 그 경로 없어도 됩니다. 바탕화면에 모든 파일을 두는
사람처럼요. 작은 시스템이라면 이렇게 하는 게 불가능하지도 않습니다.

“에러 메시지를 응답으로 반환하는지 검증하는 테스트에서 에러 코드를 이용해
검증하지 않는다”는 건 아니고, 아예 에러 코드를 쓰시지 말라는 거였어요. 이 부분은
컨트롤러에 대한 테스트가 그냥 애플리케이션 레이어에서 예외 던지면 201 created
대신 다른 거 나온다 = UI 레이어와 관련된 부분만 검증한다 정도로 진행하면 되는
거죠. 즉, 테스트 자체는 매우 단순하게 만들어집니다.

애플리케이션 서비스도 애플리케이션 레이어에서 처리하는 것만 다루면 됩니다.
리파지터리에서 객체를 얻지 못 했을 때, 도메인 객체가 예외를 던졌을 때, 이렇게
둘만 확인하면 되죠(물론 첫번째는 성공일 때 = happy path죠).

그러면 진짜로 집중해야 하는 곳은? 도메인 레이어죠. 도메인 레이어에 대한 테스트는
스프링과 전혀 무관하게 그냥 순수하게 자바와 JUnit으로 내 프로그래밍 능력을
확인하게 됩니다. 코딩 테스트 문제 푸는 것과 같은 상황이 되고, 괜찮은 객체지향
설계 = 올바른 협력, 위임을 구성하는 게 핵심이 됩니다. 여기에 JPA가 끼어드는 게
좀 귀찮을 수 있는데, 그래서 대개는 1) JPA를 아예 몰아내거나 2) JPA 숙련도를
높여서 잘 버무리거나 하죠. 일단은 제 3의 길로 JPA 숙련도가 낮아도 할 수 있는
걸로 먼저 출발하고, JPA 숙련도를 높이면서 2번으로 나아가는 게 대부분의 회사에
어울립니다.
